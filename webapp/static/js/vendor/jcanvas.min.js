/*
 jCanvas
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(c,R,W,M,X,r,A,g,s){function z(){}function C(d){d?x(Y,d):C.prefs=Y=z.prototype=x({},N);return this}function I(d,a){d.fillStyle=a.fillStyle;d.strokeStyle=a.strokeStyle;d.lineWidth=a.strokeWidth;a.rounded?(d.lineCap="round",d.lineJoin="round"):(d.lineCap=a.strokeCap,d.lineJoin=a.strokeJoin,d.miterLimit=a.miterLimit);d.shadowOffsetX=a.shadowX;d.shadowOffsetY=a.shadowY;d.shadowBlur=a.shadowBlur;d.shadowColor=a.shadowColor;d.globalAlpha=a.opacity;d.globalCompositeOperation=a.compositing}function y(d){return d&&
d.getContext?d.getContext("2d"):g}function J(d,a,b){b._event&&S(d,a,b);b.closed&&a.closePath();a.fill();"transparent"!==b.fillStyle&&(a.shadowColor="transparent");0!==b.strokeWidth&&a.stroke();b.closed||a.closePath();a.restore();b.mask&&(b.autosave&&(a.save(),d=G(d),d.transforms.mask=r,d.savedTransforms=x({},d.transforms)),a.clip())}function Z(d,a,b){a._toRad=a.inDegrees?D/180:1;d.translate(a.x,a.y);d.rotate(a.rotate*a._toRad);d.translate(-a.x,-a.y);b.rotate+=a.rotate*a._toRad}function $(d,a,b){1!==
a.scale&&(a.scaleX=a.scaleY=a.scale);d.translate(a.x,a.y);d.scale(a.scaleX,a.scaleY);d.translate(-a.x,-a.y);b.scaleX*=a.scaleX;b.scaleY*=a.scaleY}function aa(d,a,b){a.translate&&(a.translateX=a.translateY=a.translate);d.translate(a.translateX,a.translateY);b.translateX+=a.translateX;b.translateY+=a.translateY}function H(d,a,b,e,h,f){b._toRad=b.inDegrees?D/180:1;a.save();f===s&&(f=h);!d&&!b.fromCenter&&(b.x+=h/2,b.y+=f/2);b.rotate&&Z(a,b,{});(1!==b.scale||1!==b.scaleX||1!==b.scaleY)&&$(a,b,{});(b.translate||
b.translateX||b.translateY)&&aa(a,b,{})}function T(d){d.draggable&&(d.translateX+=d.x,d.translateY+=d.y)}function G(d){var a;E.elem===d?a=E.data:(a=c.data(d,"jCanvas"),a||(a={layers:[],intersects:[],drag:{},event:{},transforms:{rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,mask:A}},a.savedTransforms=x({},a.transforms),c.data(d,"jCanvas",a)),E.elem=d,E.data=a);return a}function ba(d,a,b){b&&b.visible&&(b.method===c.fn.draw?b.fn.call(d[0],a):b.method&&b.method.call(d,b))}function F(d,a,b){var e,
h,f,n="function"===typeof a,B,a=a||{};if(a.layer&&!a._layer){e=c(d);h=e.getLayers();n&&(a={method:c.fn.draw,fn:a});a=x(new z,a);if(!n){a.method=c.fn[a.method]||b;B=G(d);for(f in C.events)C.events.hasOwnProperty(f)&&a[f]&&(C.events[f](e,B),a._event=r);if(a.draggable||a.cursor){a._event=r;d=["mousedown","mousemove","mouseup"];for(b=0;b<d.length;b+=1)f=d[b],C.events[f](e,B);B.mouseout||(e.bind("mouseout.jCanvas",function(){B.drag={};e.drawLayers()}),B.mouseout=r)}}a.layer=r;a._layer=r;a.index===s&&(a.index=
h.length);h.splice(a.index,0,a)}return a}function ca(d){var a;for(a=0;a<K.length;a+=1)d[K[a]]=d["_"+K[a]]}function da(d,a){var b;for(b=0;b<K.length;b+=1)d["_"+K[b]]=d[K[b]],U[K[b]]=1,a&&delete d[K[b]]}function ea(d){var a,b,e=[],h=1;d.match(/^#?\w+$/i)&&("transparent"===d&&(d="rgba(0,0,0,0)"),b=R.head,a=b.style.color,b.style.color=d,d=c.css(b,"color"),b.style.color=a);d.match(/^rgb/i)&&(e=d.match(/\d+/gi),d.match(/%/gi)&&(h=2.55),e[0]*=h,e[1]*=h,e[2]*=h,e[3]=e[3]!==s?X(e[3]):1);return e}function ga(d){var a=
3,b;"object"!==typeof d.start&&(d.start=ea(d.start),d.end=ea(d.end));d.now=[];if(1!==d.start[3]||1!==d.end[3])a=4;for(b=0;b<a;b+=1)d.now[b]=d.start[b]+(d.end[b]-d.start[b])*d.pos,3>b&&(d.now[b]=O(d.now[b]));1!==d.start[3]||1!==d.end[3]?d.now="rgba("+d.now.join(",")+")":(d.now.slice(0,3),d.now="rgb("+d.now.join(",")+")");d.elem.nodeName?d.elem.style[d.prop]=d.now:d.elem[d.prop]=d.now}function L(d){C.events[d]=function(a,b){var e="mouseover"===d||"mouseout"===d?"mousemove":d,h=b.event;b[e]||(a.bind(e+
".jCanvas",function(b){h.x=b.offsetX;h.y=b.offsetY;h.type=e;a.drawLayers(r);b.preventDefault()}),b[e]=r)}}function S(d,a,b){var d=G(d),e=d.event,a=a.isPointInPath(e.x,e.y),h=d.transforms,f,n;b.mouseX=e.x;b.mouseY=e.y;n=d.transforms.rotate;e=b.mouseX;f=b.mouseY;b._mouseX=e*P(-n)-f*Q(-n);b._mouseY=f*P(-n)+e*Q(-n);b._mouseX/=h.scaleX;b._mouseY/=h.scaleY;!a&&(b._hovered&&!b._fired)&&(b._mousedout=r);a&&d.intersects.push(b)}function fa(d,a,b,e,h){var f=/\b(\d*\.?\d*)\w\w\b/gi,n;if(E.text===e.text&&E.font===
e.font&&E.maxWidth===e.maxWidth&&E.lineHeight===e.lineHeight)e.width=E.width,e.height=E.height;else if(!a){e.width=b.measureText(h[0]).width;for(a=1;a<h.length;a+=1)n=b.measureText(h[a]).width,n>e.width&&(e.width=n);b=d.style.fontSize;if(a=e.font.match(f))d.style.fontSize=e.font.match(f)[0];e.height=X(c.css(d,"fontSize"))*h.length*e.lineHeight;d.style.fontSize=b}}var N,Y,x=c.extend,O=M.round,D=M.PI,Q=M.sin,P=M.cos,ha=c.event.fix,E={},K,U;c.fn.jCanvas=C;C.events={};N={align:"center",autosave:r,baseline:"middle",
bringToFront:A,ccw:A,closed:A,compositing:"source-over",cornerRadius:0,cropFromCenter:r,draggable:A,disableDrag:A,disableEvents:A,each:g,end:360,fillStyle:"transparent",font:"12pt sans-serif",fromCenter:r,height:g,inDegrees:r,lineHeight:1,load:g,mask:A,maxWidth:g,method:g,miterLimit:10,opacity:1,projection:0,r1:g,r2:g,radius:0,repeat:"repeat",rotate:0,rounded:A,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:g,sides:3,source:"",start:0,strokeCap:"butt",
strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:g,sx:g,sy:g,text:"",translate:0,translateX:0,translateY:0,visible:r,width:g,x:0,y:0};C();C.extend=function(d){C.defaults=N=x(N,d.props);C();d.name&&(c.fn[d.name]=function b(e){var h,f,n,c=x(new z,e);for(f=0;f<this.length;f+=1)if(h=this[f],n=y(h))e=F(h,e,b),I(n,c),d.fn.call(h,n,e);return this});return c.fn[d.name]};c.fn.getLayers=function(){var d=this[0];return!d||!d.getContext?[]:G(d).layers};c.fn.getLayer=function(d){var a=this.getLayers(),
b=c.type(d),e,h;if(d&&d.layer)e=d;else if("number"===b)e=a[d];else for(h=0;h<a.length;h+=1)if(a[h].index=h,a[h].name===d||"regexp"===b&&a[h].name.match(d)){e=a[h];break}return e};c.fn.setLayer=function(d,a){var b,e;for(b=0;b<this.length;b+=1)(e=c(this[b]).getLayer(d))&&x(e,a);return this};c.fn.moveLayer=function(d,a){var b,e,h;for(e=0;e<this.length;e+=1)if(b=c(this[e]),h=b.getLayers(),b=b.getLayer(d))h.splice(b.index,1),h.splice(a,0,b),b.index=a;return this};c.fn.removeLayer=function(d){var a,b,e;
for(b=0;b<this.length;b+=1)a=c(this[b]),e=a.getLayers(),(a=a.getLayer(d))&&e.splice(a.index,1);return this};c.fn.removeLayers=function(){var d,a;for(d=0;d<this.length;d+=1)a=c(this[d]).getLayers(),a.length=0;return this};c.fn.getLayerGroup=function(d){var a=this.getLayers(),b=c.type(d),e=[],h;if("array"===b)return d;for(h=0;h<a.length;h+=1)a[h].index=h,(a[h].group===d||"regexp"===b&&a[h].group.match(d))&&e.push(a[h]);return e};c.fn.setLayerGroup=function(d,a){var b,e,h;for(e=0;e<this.length;e+=1){b=
c(this[e]);b=b.getLayerGroup(d);for(h=0;h<b.length;h+=1)x(b[h],a)}return this};c.fn.removeLayerGroup=function(d){var a,b,e=c.type(d),h;if(d!==s)for(b=0;b<this.length;b+=1){a=c(this[b]);a=a.getLayers();for(h=0;h<a.length;h+=1)if(a[h].index=h,a[h].group===d||"regexp"===e&&a[h].group.match(d))a.splice(h,1),h-=1}return this};c.fn.drawLayer=function(d){var a,b,e,h;for(a=0;a<this.length;a+=1)e=c(this[a]),b=y(this[a]),h=e.getLayer(d),ba(e,b,h);return this};c.fn.drawLayers=function(d){var a,b,e,h,f,n,B,t;
for(b=0;b<this.length;b+=1)if(a=c(this[b]),e=y(this[b])){G(this[b]);a.clearCanvas();E.elem===this[b]?B=E.data:(B=G(this[b]),E.elem=this[b],E.data=B);h=B.layers;for(n=0;n<h.length;n+=1)if(f=h[n],f.index=n,d&&(f._fired=A),f._event=!f.disableEvents,ba(a,e,f),f._mousedout)f._mousedout=A,f._fired=r,f._hovered=A,f.mouseout&&f.mouseout.call(this[b],f),f.cursor&&f._cursor&&a.css({cursor:f._cursor});f=B.intersects[B.intersects.length-1]||{};e=B.event;e=e.type;t=f[e];n=B.drag;if(f._event){if((f.mouseover||
f.mouseout||f.cursor)&&!f._hovered&&!f._fired)f._fired=r,f._hovered=r,f.mouseover&&f.mouseover.call(this[b],f),f.cursor&&(f._cursor=a.css("cursor"),a.css({cursor:f.cursor}));t&&!f._fired&&(f._fired=r,t.call(this[b],f));f.draggable&&(!f.disableDrag&&"mousedown"===e)&&(f.bringToFront&&(h.splice(f.index,1),f.index=h.push(f)),n.layer=f,n.dragging=r,n.startX=f.x,n.startY=f.y,n.endX=f._mouseX,n.endY=f._mouseY,f.dragstart&&f.dragstart.call(this[b],f))}if(n.layer&&(n.dragging&&"mouseup"===e&&(n.layer.dragstop&&
n.layer.dragstop.call(this[b],n.layer),B.drag={}),n.dragging&&"mousemove"===e))n.layer.x=n.layer._mouseX-(n.endX-n.startX),n.layer.y=n.layer._mouseY-(n.endY-n.startY),n.layer.drag&&n.layer.drag.call(this[b],n.layer)}B.intersects=[];return this};c.fn.addLayer=function(d){var a,b,d=d||{};for(a=0;a<this.length;a+=1)if(b=y(this[a]))d.layer=r,d=F(this[a],d);return this};K=["width","height","opacity","lineHeight"];U={};c.fn.animateLayer=function(){function d(a,b){return function(){ca(b);a.drawLayers();
f[4]&&f[4].call(a[0],b)}}function a(a,b){return function(d,e){ca(b);a.drawLayers();f[5]&&f[5].call(a[0],d,e,b)}}var b,e,h,f=[].slice.call(arguments,0);"object"===typeof f[0]&&!f[0].layer&&f.unshift(0);"object"===typeof f[2]?(f.splice(2,0,f[2].duration||g),f.splice(3,0,f[3].easing||g),f.splice(4,0,f[4].complete||g),f.splice(5,0,f[5].step||g)):(f[2]===s?(f.splice(2,0,g),f.splice(3,0,g),f.splice(4,0,g)):"function"===typeof f[2]&&(f.splice(2,0,g),f.splice(3,0,g)),f[3]===s)?(f[3]=g,f.splice(4,0,g)):"function"===
typeof f[3]&&f.splice(3,0,g);f[1]=x({},f[1]);for(e=0;e<this.length;e+=1)if(b=c(this[e]),h=y(this[e]))if(G(this[e]),(h=b.getLayer(f[0]))&&h.method!==c.fn.draw)da(h),da(f[1],r),h.style=U,c(h).animate(f[1],{duration:f[2],easing:c.easing[f[3]]?f[3]:g,complete:d(b,h),step:a(b,h)});return this};c.fn.animateLayerGroup=function(d){var a,b,e=[].slice.call(arguments,0),h,f;for(b=0;b<this.length;b+=1){a=c(this[b]);h=a.getLayerGroup(d);for(f=0;f<h.length;f+=1)a.animateLayer.apply(a,[h[f]].concat(e.slice(1)))}};
c.fn.delayLayer=function(d,a){var b,e,a=a||0;for(b=0;b<this.length;b+=1)e=c(this[b]).getLayer(d),c(e).delay(a);return this};c.fn.delayLayerGroup=function(d,a){var b,e,h,f,a=a||0;for(e=0;e<this.length;e+=1){b=c(this[e]);h=b.getLayerGroup(d);for(f=0;f<h.length;f+=1)b.delayLayer.call(b,h[f],a)}};c.fn.stopLayer=function(d,a){var b,e;for(b=0;b<this.length;b+=1)e=c(this[b]).getLayer(d),c(e).stop(a);return this};c.fn.stopLayerGroup=function(d,a){var b,e,h,f;for(e=0;e<this.length;e+=1){b=c(this[e]);h=b.getLayerGroup(d);
for(f=0;f<h.length;f+=1)b.stopLayer.call(b,h[f],a)}};(function(d){var a;for(a=0;a<d.length;a+=1)c.fx.step[d[a]]=ga})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));L("click");L("dblclick");L("mousedown");L("mouseup");L("mousemove");L("mouseover");L("mouseout");c.event.fix=function(d){var a,d=ha.call(c.event,d);if(d.pageX!==s&&d.offsetX===s&&(a=c(d.target).offset()))d.offsetX=d.pageX-a.left,
d.offsetY=d.pageY-a.top;return d};c.fn.draw=function a(b){var e,h,b=b||{};"function"===typeof b&&(b={fn:b});for(e=0;e<this.length;e+=1)if((h=y(this[e]))&&b.fn)b=F(this[e],b,a),b.fn.call(this[e],h);return this};c.fn.clearCanvas=function(a){var b,e,h=x(new z,a);for(b=0;b<this.length;b+=1)if(e=y(this[b]))H(b,e,h,a,h.width,h.height),e.setTransform(1,0,0,1,0,0),!h.x||!h.y||!h.width||!h.height?e.clearRect(0,0,this[b].width,this[b].height):e.clearRect(h.x-h.width/2,h.y-h.height/2,h.width,h.height),e.restore();
return this};c.fn.saveCanvas=function(){var a,b,e;for(a=0;a<this.length;a+=1)if(b=y(this[a]))e=G(this[a]),b.save(),e.savedTransforms=x({},e.transforms);return this};c.fn.restoreCanvas=function(){var a,b,e;for(a=0;a<this.length;a+=1)if(b=y(this[a]))e=G(this[a]),b.restore(),e.transforms=x({},e.savedTransforms);return this};c.fn.translateCanvas=function(a){for(var b,e=x(new z,a),h,a=0;a<this.length;a+=1)if(b=y(this[a]))h=G(this[a]),e.autosave&&b.save(),aa(b,e,h.transforms);return this};c.fn.scaleCanvas=
function(a){for(var b,e=x(new z,a),h,a=0;a<this.length;a+=1)if(b=y(this[a]))h=G(this[a]),e.autosave&&b.save(),$(b,e,h.transforms);return this};c.fn.rotateCanvas=function(a){for(var b,e=x(new z,a),h,a=0;a<this.length;a+=1)if(b=y(this[a]))h=G(this[a]),e.autosave&&b.save(),Z(b,e,h.transforms);return this};c.fn.drawRect=function b(e){var h,f,n=x(new z,e),c,t,g,v,p;for(h=0;h<this.length;h+=1)if(f=y(this[h]))e=F(this[h],e,b),I(f,n),H(h,f,n,e,n.width,n.height),f.beginPath(),c=n.x-n.width/2,t=n.y-n.height/
2,(p=n.cornerRadius)?(n.closed=r,g=n.x+n.width/2,v=n.y+n.height/2,0>g-c-2*p&&(p=(g-c)/2),0>v-t-2*p&&(p=(v-t)/2),f.moveTo(c+p,t),f.lineTo(g-p,t),f.arc(g-p,t+p,p,3*D/2,2*D,A),f.lineTo(g,v-p),f.arc(g-p,v-p,p,0,D/2,A),f.lineTo(c+p,v),f.arc(c+p,v-p,p,D/2,D,A),f.lineTo(c,t+p),f.arc(c+p,t+p,p,D,3*D/2,A)):f.rect(c,t,n.width,n.height),J(this[h],f,e);return this};c.fn.drawArc=function e(h){var f,c,g=x(new z,h),h=h||{};!g.inDegrees&&360===g.end&&(h.end=g.end=2*D);for(f=0;f<this.length;f+=1)if(c=y(this[f]))h=
F(this[f],h,e),I(c,g),H(f,c,g,h,2*g.radius),c.beginPath(),c.arc(g.x,g.y,g.radius,g.start*g._toRad-D/2,g.end*g._toRad-D/2,g.ccw),J(this[f],c,h);return this};c.fn.drawEllipse=function h(f){var c,g,t=x(new z,f),w=4*t.width/3,v=t.height;t.closed=r;for(c=0;c<this.length;c+=1)if(g=y(this[c]))f=F(this[c],f,h),I(g,t),H(c,g,t,f,t.width,t.height),g.beginPath(),g.moveTo(t.x,t.y-v/2),g.bezierCurveTo(t.x-w/2,t.y-v/2,t.x-w/2,t.y+v/2,t.x,t.y+v/2),g.bezierCurveTo(t.x+w/2,t.y+v/2,t.x+w/2,t.y-v/2,t.x,t.y-v/2),J(this[c],
g,f);return this};c.fn.drawPolygon=function f(c){var g,t,w=x(new z,c),v=2*D/w.sides,p=D/w.sides,m=p+D/2,k=w.radius*P(v/2),l,o,q;c.closed=w.closed=r;for(g=0;g<this.length;g+=1)if(t=y(this[g])){c=F(this[g],c,f);I(t,w);H(g,t,w,c,2*w.radius);t.beginPath();for(q=0;q<w.sides;q+=1)l=w.x+O(w.radius*P(m)),o=w.y+O(w.radius*Q(m)),t.lineTo(l,o),w.projection&&(l=w.x+O((k+k*w.projection)*P(m+p)),o=w.y+O((k+k*w.projection)*Q(m+p)),t.lineTo(l,o)),m+=v;J(this[g],t,c)}return this};c.fn.drawLine=function n(c){var g,
w,v=x(new z,c),p,m,k;for(g=0;g<this.length;g+=1)if(w=y(this[g])){c=F(this[g],c,n);I(w,v);T(v);H(g,w,v,c,0);p=1;for(w.beginPath();r;)if(m=v["x"+p],k=v["y"+p],m!==s&&k!==s)w.lineTo(m,k),p+=1;else break;J(this[g],w,c)}return this};c.fn.drawQuad=function B(c){var g,v,p=x(new z,c),m,k,l,o,q;for(g=0;g<this.length;g+=1)if(v=y(this[g])){c=F(this[g],c,B);I(v,p);T(p);H(g,v,p,c,0);m=2;v.beginPath();for(v.moveTo(p.x1,p.y1);r;)if(k=p["x"+m],l=p["y"+m],o=p["cx"+(m-1)],q=p["cy"+(m-1)],k!==s&&l!==s&&o!==s&&q!==s)v.quadraticCurveTo(o,
q,k,l),m+=1;else break;J(this[g],v,c)}return this};c.fn.drawBezier=function t(c){var g,p,m=x(new z,c),k,l,o,q,j,i,u,V;for(g=0;g<this.length;g+=1)if(p=y(this[g])){c=F(this[g],c,t);I(p,m);T(m);H(g,p,m,c,0);k=2;l=1;p.beginPath();for(p.moveTo(m.x1,m.y1);r;)if(o=m["x"+k],q=m["y"+k],j=m["cx"+l],i=m["cy"+l],u=m["cx"+(l+1)],V=m["cy"+(l+1)],o!==s&&q!==s&&j!==s&&i!==s&&u!==s&&V!==s)p.bezierCurveTo(j,i,u,V,o,q),k+=1,l+=2;else break;J(this[g],p,c)}return this};c.fn.drawVector=function w(c){var g,m,k=x(new z,
c),l,o,q,j,i;for(g=0;g<this.length;g+=1)if(m=y(this[g])){c=F(this[g],c,w);I(m,k);H(g,m,k,c,0);l=1;m.beginPath();j=k.x;i=k.y;for(m.moveTo(k.x,k.y);r;)if(o=k["a"+l],q=k["l"+l],o!==s&&q!==s)o=o*k._toRad-D/2,j+=q*M.cos(o),i+=q*M.sin(o),m.lineTo(j,i),l+=1;else break;J(this[g],m,c)}return this};c.fn.drawText=function v(p){var m,k,l=x(new z,p),o,q,j,i;for(m=0;m<this.length;m+=1)if(c(this[m]),k=y(this[m])){p=F(this[m],p,v);I(k,l);k.textBaseline=l.baseline;k.textAlign=l.align;k.font=l.font;if(!m&&l.maxWidth!==
g){o=k;q=l.text;i=l.maxWidth;var u=l.text.split(" "),r=[],s="";if(o.measureText(q).width<i||1===u.length)r=[q];else for(;0<u.length;)o.measureText(u[0]).width>i||o.measureText(s+u[0]).width<i?s+=u.shift()+" ":(r.push(s),s=""),0===u.length&&r.push(s);o=r;o=o.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n")}else m||(o=(""+l.text).split("\n"));fa(this[m],m,k,l,o);H(m,k,l,p,l.width,l.height);m||(j=l.x,"left"===l.align?j-=l.width/2:"right"===l.align&&(j+=l.width/2));for(q=0;q<o.length;q+=1)k.shadowColor=
l.shadowColor,i=l.y+q*l.height/o.length-(o.length-1)*l.height/o.length/2,k.fillText(o[q],j,i),"transparent"!==l.fillStyle&&(k.shadowColor="transparent"),k.strokeText(o[q],j,i);l._event?(k.beginPath(),k.rect(l.x-l.width/2,l.y-l.height/2,l.width,l.height),k.restore(),S(this[m],k,p),k.closePath()):k.restore()}E=l;return this};c.fn.measureText=function(c){var g;g=c!==s&&"object"!==typeof c?this.getLayer(c):x(new z,c);(c=y(this[0]))&&g.text!==s&&fa(this[0],0,c,g,g.text.split("\n"));return g};c.fn.drawImage=
function p(c){function k(p,k,j){return function(){k||((r=u.width/u.height,i.width===g&&i.sWidth===g&&(c.width=i.width=i.sWidth=u.width),i.height===g&&i.sHeight===g&&(c.height=i.height=i.sHeight=u.height),i.width===g&&i.sWidth!==g&&(i.width=i.sWidth),i.height===g&&i.sHeight!==g&&(i.height=i.sHeight),i.sWidth===g&&i.width!==g&&(c.sWidth=i.sWidth=u.width),i.sHeight===g&&i.height!==g&&(c.sHeight=i.sHeight=u.height),i.sx===g&&(i.sx=i.cropFromCenter?u.width/2:0),i.sy===g&&(i.sy=i.cropFromCenter?u.height/
2:0),i.cropFromCenter||(i.sx+=i.sWidth/2,i.sy+=i.sHeight/2),i.sx+i.sWidth/2>u.width&&(i.sx=u.width-i.sWidth/2),0>i.sx-i.sWidth/2&&(i.sx=i.sWidth/2),0>i.sy-i.sHeight/2&&(i.sy=i.sHeight/2),i.sy+i.sHeight/2>u.height&&(i.sy=u.height-i.sHeight/2),i.width!==g&&i.height===g)?c.height=i.height=i.width/r:i.width===g&&i.height!==g?c.width=i.width=i.height*r:i.width===g&&i.height===g&&(c.width=i.width=u.width,c.height=i.height=u.height));H(k,j,i,c,i.width,i.height);j.drawImage(u,i.sx-i.sWidth/2,i.sy-i.sHeight/
2,i.sWidth,i.sHeight,i.x-i.width/2,i.y-i.height/2,i.width,i.height);j.fillStyle=j.strokeStyle="transparent";j.beginPath();j.rect(i.x-i.width/2,i.y-i.height/2,i.width,i.height);J(l[k],j,c);i.load&&i.load.call(p,c)}}var l=this,o,q,j,i=x(new z,c),u,s,r;s=i.source.getContext;i.source.src||s?(u=i.source,i.width=u.width,i.height=u.height):i.source&&(u=new W,u.src=i.source);for(q=0;q<l.length;q+=1)if(o=l[q],j=y(l[q]))c=F(l[q],c,p),I(j,i),u&&(u.complete||s?k(o,q,j)():(u.onload=k(o,q,j),u.src=u.src));return l};
c.fn.createPattern=c.fn.pattern=function(c){function m(){j=l.createPattern(q,o.repeat);o.load&&o.load.call(k[0],j)}var k=this,l,o=x(new z,c),q,j;(l=y(k[0]))?"function"===typeof o.source?(q=R.createElement("canvas"),q.width=o.width,q.height=o.height,c=y(q),o.source.call(q,c),m()):(c=o.source.getContext,o.source.src||c?q=o.source:(q=new W,q.src=o.source),q.complete||c?m():q.onload=m):j=g;return j};c.fn.createGradient=c.fn.gradient=function(c){var m,c=x(new z,c),k=[],l,o,q,j,i,u,r;if(m=y(this[0])){c.x1=
c.x1||0;c.y1=c.y1||0;c.x2=c.x2||0;c.y2=c.y2||0;m=c.r1!==g||c.r2!==g?m.createRadialGradient(c.x1,c.y1,c.r1,c.x2,c.y2,c.r2):m.createLinearGradient(c.x1,c.y1,c.x2,c.y2);for(j=1;c["c"+j]!==s;j+=1)c["s"+j]!==s?k.push(c["s"+j]):k.push(g);l=k.length;k[0]===g&&(k[0]=0);k[l-1]===g&&(k[l-1]=1);for(j=0;j<l;j+=1){if(k[j]!==g){u=1;r=0;o=k[j];for(i=j+1;i<l;i+=1)if(k[i]!==g){q=k[i];break}else u+=1;o>q&&(k[i]=k[j])}else k[j]===g&&(r+=1,k[j]=o+r*((q-o)/u));m.addColorStop(k[j],c["c"+(j+1)])}}else m=g;return m};c.fn.setPixels=
function m(c){var g,o,q,j=x(new z,c),i={},u,r,s,A;for(o=0;o<this.length;o+=1)if(g=this[o],q=y(g)){c=F(this[o],c,m);H(o,q,j,c,j.width,j.height);if(!j.x||!j.y||!j.width||!j.height)j.width=g.width,j.height=g.height,j.x=j.width/2,j.y=j.height/2;u=q.getImageData(j.x-j.width/2,j.y-j.height/2,j.width,j.height);r=u.data;A=r.length;i=[];if(j.each)for(s=0;s<A;s+=4)i.r=r[s],i.g=r[s+1],i.b=r[s+2],i.a=r[s+3],j.each.call(g,i),r[s]=i.r,r[s+1]=i.g,r[s+2]=i.b,r[s+3]=i.a;q.putImageData(u,j.x-j.width/2,j.y-j.height/
2);q.restore()}return this};c.fn.getCanvasImage=function(c,k){var l=this[0];return l&&l.toDataURL?l.toDataURL("image/"+c,k):g};c.support.canvas=R.createElement("canvas").getContext!==s;C.defaults=N;C.detectEvents=S;C.closePath=J;c.jCanvas=C})(jQuery,document,Image,Math,parseFloat,!0,!1,null);
